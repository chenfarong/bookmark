<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>nginx配置</title>
  </head>
  <body>
    <h1 align="center">NGINX 配置</h1>
    <br>
    <div style="color: rgb(0, 0, 0); font-family: Verdana, Arial,
      Helvetica, sans-serif; font-size: 14px; font-style: normal;
      font-variant-ligatures: normal; font-variant-caps: normal;
      font-weight: 400; letter-spacing: normal; orphans: 2; text-align:
      start; text-indent: 0px; text-transform: none; white-space:
      normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width:
      0px; background-color: rgb(255, 255, 255); text-decoration-style:
      initial; text-decoration-color: initial;"><strong>配置目录访问需要用户名和密码</strong></div>
    <div style="color: rgb(0, 0, 0); font-family: Verdana, Arial,
      Helvetica, sans-serif; font-size: 14px; font-style: normal;
      font-variant-ligatures: normal; font-variant-caps: normal;
      font-weight: 400; letter-spacing: normal; orphans: 2; text-align:
      start; text-indent: 0px; text-transform: none; white-space:
      normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width:
      0px; background-color: rgb(255, 255, 255); text-decoration-style:
      initial; text-decoration-color: initial;">
      <div class="cnblogs_code" style="background-color: rgb(245, 245,
        245); border: 1px solid rgb(204, 204, 204); padding: 5px;
        overflow: auto; margin: 5px 0px; color: rgb(0, 0, 0);
        font-family: &quot;Courier New&quot; !important; font-size: 12px
        !important;">
        <pre style="margin: 0px 0px 0px 22px; white-space: pre-wrap; overflow-wrap: break-word; font-size: 12px !important; font-family: &quot;Courier New&quot; !important;"><span style="font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0);">location /<br>{<br>	auth_basic "Password";<br>	auth_basic_user_file /www/my/passwdfile;<br>}</span><br></pre>
      </div>
    </div>
    <br>
    <br>
    <br>
    <div style="color: rgb(0, 0, 0); font-family: Verdana, Arial,
      Helvetica, sans-serif; font-size: 14px; font-style: normal;
      font-variant-ligatures: normal; font-variant-caps: normal;
      font-weight: 400; letter-spacing: normal; orphans: 2; text-align:
      start; text-indent: 0px; text-transform: none; white-space:
      normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width:
      0px; background-color: rgb(255, 255, 255); text-decoration-style:
      initial; text-decoration-color: initial;"><strong>生成目录访问用户名和密码</strong></div>
    <div style="color: rgb(0, 0, 0); font-family: Verdana, Arial,
      Helvetica, sans-serif; font-size: 14px; font-style: normal;
      font-variant-ligatures: normal; font-variant-caps: normal;
      font-weight: 400; letter-spacing: normal; orphans: 2; text-align:
      start; text-indent: 0px; text-transform: none; white-space:
      normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width:
      0px; background-color: rgb(255, 255, 255); text-decoration-style:
      initial; text-decoration-color: initial;">
      <div class="cnblogs_code" style="background-color: rgb(245, 245,
        245); border: 1px solid rgb(204, 204, 204); padding: 5px;
        overflow: auto; margin: 5px 0px; color: rgb(0, 0, 0);
        font-family: &quot;Courier New&quot; !important; font-size: 12px
        !important;">
        <pre style="margin: 0px 0px 0px 22px; white-space: pre-wrap; overflow-wrap: break-word; font-size: 12px !important; font-family: &quot;Courier New&quot; !important;">htpasswd -c /www/my/passwdfile username password</pre>
      </div>
    </div>
    <br>
    <br>
    <br>
    <br>
    <meta charset="utf-8">
    <div style="color: rgb(0, 0, 0); font-family: Verdana, Arial,
      Helvetica, sans-serif; font-size: 14px; font-style: normal;
      font-variant-ligatures: normal; font-variant-caps: normal;
      font-weight: 400; letter-spacing: normal; orphans: 2; text-align:
      start; text-indent: 0px; text-transform: none; white-space:
      normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width:
      0px; background-color: rgb(255, 255, 255); text-decoration-style:
      initial; text-decoration-color: initial;"><strong>proxy_pass</strong></div>
    <div style="color: rgb(0, 0, 0); font-family: Verdana, Arial,
      Helvetica, sans-serif; font-size: 14px; font-style: normal;
      font-variant-ligatures: normal; font-variant-caps: normal;
      font-weight: 400; letter-spacing: normal; orphans: 2; text-align:
      start; text-indent: 0px; text-transform: none; white-space:
      normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width:
      0px; background-color: rgb(255, 255, 255); text-decoration-style:
      initial; text-decoration-color: initial;">
      <div class="cnblogs_code" style="background-color: rgb(245, 245,
        245); border: 1px solid rgb(204, 204, 204); padding: 5px;
        overflow: auto; margin: 5px 0px; color: rgb(0, 0, 0);
        font-family: &quot;Courier New&quot; !important; font-size: 12px
        !important;">
        <pre style="margin: 0px 0px 0px 22px; white-space: pre-wrap; overflow-wrap: break-word; font-size: 12px !important; font-family: &quot;Courier New&quot; !important;"><span style="font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0);">Syntax:    proxy_pass URL;
Default:    —
Context:    location, </span><span style="font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255);">if</span> <span style="font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255);">in</span> location, limit_except</pre>
      </div>
    </div>
    <div style="color: rgb(0, 0, 0); font-family: Verdana, Arial,
      Helvetica, sans-serif; font-size: 14px; font-style: normal;
      font-variant-ligatures: normal; font-variant-caps: normal;
      font-weight: 400; letter-spacing: normal; orphans: 2; text-align:
      start; text-indent: 0px; text-transform: none; white-space:
      normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width:
      0px; background-color: rgb(255, 255, 255); text-decoration-style:
      initial; text-decoration-color: initial;">
      <ul style="margin-left: 30px; padding-left: 0px;">
        <li style="list-style-type: disc;">不影响浏览器地址栏的url</li>
        <li style="list-style-type: disc;">设置被代理server的协议和地址，URI可选（可以有，也
          可以没有）</li>
        <li style="list-style-type: disc;">协议可以为http或https</li>
        <li style="list-style-type: disc;">地址可以为域名或者IP，端口可选；eg：<br>
          <div class="cnblogs_code" style="background-color: rgb(245,
            245, 245); border: 1px solid rgb(204, 204, 204); padding:
            5px; overflow: auto; margin: 5px 0px; color: rgb(0, 0, 0);
            font-family: &quot;Courier New&quot; !important; font-size:
            12px !important;">
            <pre style="margin: 0px 0px 0px 22px; white-space: pre-wrap; overflow-wrap: break-word; font-size: 12px !important; font-family: &quot;Courier New&quot; !important;"> proxy_pass http:<span style="font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0);">//</span><span style="font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0);">localhost:8000/uri/;</span></pre>
          </div>
        </li>
        <li style="list-style-type: disc;">&nbsp;如果一个域名可以解析到多个地址，那么这些地址会
          被轮流使用，此外，还可以把一个地址指定为 server group（如：nginx的upstream）, eg:<br>
          <div class="cnblogs_code" style="background-color: rgb(245,
            245, 245); border: 1px solid rgb(204, 204, 204); padding:
            5px; overflow: auto; margin: 5px 0px; color: rgb(0, 0, 0);
            font-family: &quot;Courier New&quot; !important; font-size:
            12px !important;">
            <div class="cnblogs_code_toolbar" style="margin-top: 5px;
              background-color: rgb(245, 245, 245);"><span
                class="cnblogs_code_copy" style="font-family:
                &quot;Courier New&quot; !important; font-size: 12px
                !important; line-height: 1.5 !important; padding-right:
                5px;"><a href="javascript:void(0);"
                  onclick="copyCnblogsCode(this)" title="复制代码"
                  style="color: rgb(29, 88, 209); text-decoration: none;
                  background-color: rgb(245, 245, 245) !important;
                  border: none !important;"><img
                    src="https://common.cnblogs.com/images/copycode.gif"
                    alt="复制代码" style="border: none !important;
                    background-color: rgb(245, 245, 245) !important;
                    max-width: 900px; height: auto;"></a></span></div>
            <pre style="margin: 0px 0px 0px 22px; white-space: pre-wrap; overflow-wrap: break-word; font-size: 12px !important; font-family: &quot;Courier New&quot; !important;"><span style="font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0);">upstream backend {
    server backend1.example.com       weight</span>=<span style="font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128);">5</span><span style="font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0);">;
    server backend2.example.com:</span><span style="font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128);">8080</span><span style="font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0);">;
    server unix:</span>/tmp/<span style="font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0);">backend3;
 
    server backup1.example.com:</span><span style="font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128);">8080</span><span style="font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0);">   backup;
    server backup2.example.com:</span><span style="font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128);">8080</span><span style="font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0);">   backup;
}
 
server {
    location </span>/<span style="font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0);"> {
        proxy_pass http:</span><span style="font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0);">//</span><span style="font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0);">backend;</span>
<span style="font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0);">    }
}</span></pre>
            <div class="cnblogs_code_toolbar" style="margin-top: 5px;
              background-color: rgb(245, 245, 245);"><span
                class="cnblogs_code_copy" style="font-family:
                &quot;Courier New&quot; !important; font-size: 12px
                !important; line-height: 1.5 !important; padding-right:
                5px;"><a href="javascript:void(0);"
                  onclick="copyCnblogsCode(this)" title="复制代码"
                  style="color: rgb(29, 88, 209); text-decoration: none;
                  background-color: rgb(245, 245, 245) !important;
                  border: none !important;"><img
                    src="https://common.cnblogs.com/images/copycode.gif"
                    alt="复制代码" style="border: none !important;
                    background-color: rgb(245, 245, 245) !important;
                    max-width: 900px; height: auto;"></a></span></div>
          </div>
        </li>
        <li style="list-style-type: disc;">server name， port，
          URI支持变量的形式，eg：<br>
          <div class="cnblogs_code" style="background-color: rgb(245,
            245, 245); border: 1px solid rgb(204, 204, 204); padding:
            5px; overflow: auto; margin: 5px 0px; color: rgb(0, 0, 0);
            font-family: &quot;Courier New&quot; !important; font-size:
            12px !important;">
            <pre style="margin: 0px 0px 0px 22px; white-space: pre-wrap; overflow-wrap: break-word; font-size: 12px !important; font-family: &quot;Courier New&quot; !important;">proxy_pass http:<span style="font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0);">//</span><span style="font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0);">$host$uri;</span></pre>
          </div>
        </li>
      </ul>
    </div>
    <div style="color: rgb(0, 0, 0); font-family: Verdana, Arial,
      Helvetica, sans-serif; font-size: 14px; font-style: normal;
      font-variant-ligatures: normal; font-variant-caps: normal;
      font-weight: 400; letter-spacing: normal; orphans: 2; text-align:
      start; text-indent: 0px; text-transform: none; white-space:
      normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width:
      0px; background-color: rgb(255, 255, 255); text-decoration-style:
      initial; text-decoration-color: initial; margin-left: 30px;">这种情况
      下，nginx会在server groups（upstream后端server）里搜索server
      name，如果没有找到，会用dns解析</div>
    <div style="color: rgb(0, 0, 0); font-family: Verdana, Arial,
      Helvetica, sans-serif; font-size: 14px; font-style: normal;
      font-variant-ligatures: normal; font-variant-caps: normal;
      font-weight: 400; letter-spacing: normal; orphans: 2; text-align:
      start; text-indent: 0px; text-transform: none; white-space:
      normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width:
      0px; background-color: rgb(255, 255, 255); text-decoration-style:
      initial; text-decoration-color: initial; margin-left: 30px;">请求的
      URI按照下面的规则传给后端server</div>
    <div style="color: rgb(0, 0, 0); font-family: Verdana, Arial,
      Helvetica, sans-serif; font-size: 14px; font-style: normal;
      font-variant-ligatures: normal; font-variant-caps: normal;
      font-weight: 400; letter-spacing: normal; orphans: 2; text-align:
      start; text-indent: 0px; text-transform: none; white-space:
      normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width:
      0px; background-color: rgb(255, 255, 255); text-decoration-style:
      initial; text-decoration-color: initial; margin-left: 30px;">
      <ol style="padding-left: 40px;">
        <li style="list-style-type: decimal;">如果proxy_pass的URL定向里包括URI，那
          么请求中匹配到location中URI的部分会被proxy_pass后面URL中的URI替换，eg：<br>
          <div class="cnblogs_code" style="background-color: rgb(245,
            245, 245); border: 1px solid rgb(204, 204, 204); padding:
            5px; overflow: auto; margin: 5px 0px; color: rgb(0, 0, 0);
            font-family: &quot;Courier New&quot; !important; font-size:
            12px !important;">
            <pre style="margin: 0px 0px 0px 22px; white-space: pre-wrap; overflow-wrap: break-word; font-size: 12px !important; font-family: &quot;Courier New&quot; !important;">location /name/<span style="font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0);"> {
    proxy_pass http:</span><span style="font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0);">//</span><span style="font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0);">127.0.0.1/remote/;</span>
<span style="font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0);">}
请求http:</span><span style="font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0);">//</span><span style="font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0);">127.0.0.1/name/test.html 会被代理到http:</span><span style="font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0);">//</span><span style="font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0);">example.com/remote/test.html</span></pre>
          </div>
        </li>
        <li style="list-style-type: decimal;">如果proxy_pass的URL定向里不包括URI，
          那么请求中的URI会保持原样传送给后端server，eg：
          <div class="cnblogs_code" style="background-color: rgb(245,
            245, 245); border: 1px solid rgb(204, 204, 204); padding:
            5px; overflow: auto; margin: 5px 0px; color: rgb(0, 0, 0);
            font-family: &quot;Courier New&quot; !important; font-size:
            12px !important;">
            <pre style="margin: 0px 0px 0px 22px; white-space: pre-wrap; overflow-wrap: break-word; font-size: 12px !important; font-family: &quot;Courier New&quot; !important;">location /name/<span style="font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0);"> {
    proxy_pass http:</span><span style="font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0);">//</span><span style="font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0);">127.0.0.1;</span>
<span style="font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0);">}

请求http:</span><span style="font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0);">//</span><span style="font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0);">127.0.0.1/name/test.html 会被代理到http:</span><span style="font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0);">//</span><span style="font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0);">127.0.0.1/name/test.html</span></pre>
          </div>
        </li>
        <li style="list-style-type: decimal;">&nbsp;一些情况下，不能确定替换的URI<br>
          <br>
          <ol style="padding-left: 40px;">
            <li style="list-style-type: decimal;">location里是正则表达式，这种情况
              下，proxy_pass里最好不要有URI</li>
            <li style="list-style-type: decimal;">在proxy_pass前面用了
              rewrite，如下，这种情况下，proxy_pass是无效的，eg：<br>
              <div class="cnblogs_code" style="background-color:
                rgb(245, 245, 245); border: 1px solid rgb(204, 204,
                204); padding: 5px; overflow: auto; margin: 5px 0px;
                color: rgb(0, 0, 0); font-family: &quot;Courier
                New&quot; !important; font-size: 12px !important;">
                <pre style="margin: 0px 0px 0px 22px; white-space: pre-wrap; overflow-wrap: break-word; font-size: 12px !important; font-family: &quot;Courier New&quot; !important;">location /name/<span style="font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0);"> {
    rewrite    </span>/name/([^/]+) /users?name=$<span style="font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128);">1</span><span style="font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0);"> break;
    proxy_pass http:</span><span style="font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0);">//</span><span style="font-family: &quot;Courier New&quot; !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0);">127.0.0.1;</span>
}</pre>
              </div>
              <p style="margin: 10px auto; text-indent: 0px;">&nbsp;</p>
            </li>
          </ol>
        </li>
      </ol>
    </div>
  </body>
</html>
